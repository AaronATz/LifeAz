{"version":3,"sources":["ng://ngx-ellipsis/lib/directives/ellipsis.directive.ts","ng://ngx-ellipsis/lib/ellipsis.module.ts"],"names":["EllipsisDirective","elementRef","renderer","ngZone","this","applyOnWindowResize","ellipsisContent","moreClickEmitter","EventEmitter","numericBinarySearch","max","callback","mid","low","high","best","escapeHtml","unsafe","undefined","String","replace","prototype","ngAfterViewInit","ellipsisCharacters","observers","length","ellipsisWordBoundaries","elem","nativeElement","originalText","innerText","setProperty","innerElem","createElement","addClass","text","createText","appendChild","addResizeListener","ngOnChanges","applyEllipsis","ngOnDestroy","removeAllListeners","destroyMoreClickListener","removeResizeListener","triggerNow","resizeDetectionStrategy","addElementResizeListener","console","warn","onResize","event","_this","run","scrollStrategy","elementResizeDetector","elementResizeDetectorMaker","strategy","calledAsynchronously","listenTo","getTruncatedText","truncatedText","substr","charAt","match","i","truncateText","addMoreListener","listen","e","target","className","preventDefault","emit","maxLength","curLength","isOverflowing","Object","defineProperty","currentOverflow","style","overflow","clientWidth","scrollWidth","clientHeight","scrollHeight","Directive","args","selector","ElementRef","Renderer2","NgZone","Input","Output","HostListener","EllipsisModule","NgModule","imports","declarations","exports"],"mappings":"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","sourcesContent":["import {\n  Directive,\n  ElementRef,\n  Renderer2,\n  Input,\n  Output,\n  EventEmitter,\n  NgZone,\n  HostListener,\n  OnChanges,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport * as elementResizeDetectorMaker from 'element-resize-detector';\n\n/**\n * Directive to truncate the contained text, if it exceeds the element's boundaries\n * and append characters (configurable, default '...') if so.\n */\n@Directive({\n  selector: '[ellipsis]'\n})\nexport class EllipsisDirective implements OnChanges, OnDestroy, AfterViewInit {\n  /**\n   * Instance of https://github.com/wnr/element-resize-detector\n   */\n  private static elementResizeDetector: elementResizeDetectorMaker.Erd = null;\n\n  /**\n   * The original text (not truncated yet)\n   */\n  private originalText: string;\n\n  /**\n   * The referenced element\n   */\n  private elem: any;\n\n  /**\n   * Inner div element (will be auto-created)\n   */\n  private innerElem: any;\n\n  /**\n   * Whether the ellipsis should be applied on window resize\n   */\n  private applyOnWindowResize = false;\n\n  /**\n   * Remove function for the currently registered click listener\n   * on the link `this.ellipsisCharacters` are wrapped in.\n   */\n  private destroyMoreClickListener: () => void;\n\n  /**\n   * The ellipsis html attribute\n   * If anything is passed, this will be used as a string to append to\n   * the truncated contents.\n   * Else '...' will be appended.\n   */\n  @Input('ellipsis') ellipsisCharacters: string;\n\n  /**\n   * The ellipsis-content html attribute\n   * If passed this is used as content, else contents\n   * are fetched from innerHTML\n   */\n  @Input('ellipsis-content') ellipsisContent: string = null;\n\n  /**\n   * The ellipsis-word-boundaries html attribute\n   * If anything is passed, each character will be interpreted\n   * as a word boundary at which the text may be truncated.\n   * Else the text may be truncated at any character.\n   */\n  @Input('ellipsis-word-boundaries') ellipsisWordBoundaries: string;\n\n  /**\n   * The ellipsis-resize-detection html attribute\n   * Algorithm to use to detect element/window resize - any of the following:\n   * 'element-resize-detector': (default) Use https://github.com/wnr/element-resize-detector with its 'scroll' strategy\n   * 'element-resize-detector-object': Use https://github.com/wnr/element-resize-detector with its 'object' strategy (deprecated)\n   * 'window': Only check if the whole window has been resized/changed orientation by using angular's built-in HostListener\n   */\n  @Input('ellipsis-resize-detection') resizeDetectionStrategy: '' | 'element-resize-detector' | 'element-resize-detector-object' | 'window';\n\n  /**\n   * The ellipsis-click-more html attribute\n   *  If anything is passed, the ellipsisCharacters will be\n   *  wrapped in <a></a> tags and an event handler for the\n   *  passed function will be added to the link\n   */\n  @Output('ellipsis-click-more') moreClickEmitter: EventEmitter<any> = new EventEmitter();\n\n\n  /**\n   * Utility method to quickly find the largest number for\n   * which `callback(number)` still returns true.\n   * @param  max      Highest possible number\n   * @param  callback Should return true as long as the passed number is valid\n   * @return          Largest possible number\n   */\n  private static numericBinarySearch(max: number, callback: (n: number) => boolean): number {\n    let low = 0;\n    let high = max;\n    let best = -1;\n    let mid: number;\n\n    while (low <= high) {\n      // tslint:disable-next-line:no-bitwise\n      mid = ~~((low + high) / 2);\n      const result = callback(mid);\n      if (!result) {\n        high = mid - 1;\n      } else {\n        best = mid;\n        low = mid + 1;\n      }\n    }\n\n    return best;\n  }\n\n  /**\n   * Escape html special characters\n   * @param unsafe string potentially containing special characters\n   * @return       escaped string\n   */\n  private static escapeHtml(unsafe: string): string {\n    if (unsafe === undefined || unsafe === null) {\n      return '';\n    }\n\n    return String(unsafe)\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  }\n\n  /**\n   * The directive's constructor\n   */\n  public constructor(private elementRef: ElementRef, private renderer: Renderer2, private ngZone: NgZone) { }\n\n  /**\n   * Angular's init view life cycle hook.\n   * Initializes the element for displaying the ellipsis.\n   */\n  ngAfterViewInit() {\n    // let the ellipsis characters default to '...':\n    if (this.ellipsisCharacters === '') {\n      this.ellipsisCharacters = '...';\n    }\n\n    if (this.moreClickEmitter.observers.length > 0) {\n      this.ellipsisCharacters = `<a href=\"#\" class=\"ngx-ellipsis-more\">${this.ellipsisCharacters}</a>`;\n    }\n\n    // perform regex replace on word boundaries:\n    if (!this.ellipsisWordBoundaries) {\n      this.ellipsisWordBoundaries = '';\n    }\n    this.ellipsisWordBoundaries = '[' + this.ellipsisWordBoundaries.replace(/\\\\n/, '\\n').replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&') + ']';\n\n    // store the original contents of the element:\n    this.elem = this.elementRef.nativeElement;\n    if (this.ellipsisContent) {\n      this.originalText = EllipsisDirective.escapeHtml(this.ellipsisContent);\n    } else if (!this.originalText) {\n      this.originalText = this.elem.innerText;\n    }\n\n    // add a wrapper div (required for resize events to work properly):\n    this.renderer.setProperty(this.elem, 'innerHTML', '');\n    this.innerElem = this.renderer.createElement('div');\n    this.renderer.addClass(this.innerElem, 'ngx-ellipsis-inner');\n    const text = this.renderer.createText(this.originalText);\n    this.renderer.appendChild(this.innerElem, text);\n    this.renderer.appendChild(this.elem, this.innerElem);\n\n    // start listening for resize events:\n    this.addResizeListener(true);\n  }\n\n  /**\n   * Angular's change life cycle hook.\n   * Change original text (if the ellipsis-content has been passed)\n   * and re-render\n   */\n  ngOnChanges() {\n    if (!this.elem\n      || typeof this.ellipsisContent === 'undefined'\n      || this.originalText === EllipsisDirective.escapeHtml(this.ellipsisContent)) {\n      return;\n    }\n\n    this.originalText = EllipsisDirective.escapeHtml(this.ellipsisContent);\n    this.applyEllipsis();\n  }\n\n  /**\n   * Angular's destroy life cycle hook.\n   * Remove event listeners\n   */\n  ngOnDestroy() {\n    this.removeAllListeners();\n  }\n\n  /**\n   * remove all resize listeners\n   */\n  private removeAllListeners() {\n    if (this.destroyMoreClickListener) {\n      this.destroyMoreClickListener();\n    }\n\n    this.removeResizeListener();\n  }\n\n\n  /**\n   * Set up an event listener to call applyEllipsis() whenever a resize has been registered.\n   * The type of the listener (window/element) depends on the resizeDetectionStrategy.\n   * @param triggerNow=false if true, the ellipsis is applied immediately\n   */\n  private addResizeListener(triggerNow = false) {\n    if (typeof (this.resizeDetectionStrategy) === 'undefined') {\n      this.resizeDetectionStrategy = '';\n    }\n\n    switch (this.resizeDetectionStrategy) {\n      case 'window':\n        this.applyOnWindowResize = true;\n        if (triggerNow) {\n          this.applyEllipsis();\n        }\n        break;\n      case 'element-resize-detector-object':\n        this.addElementResizeListener(false);\n        break;\n      default:\n        if (typeof (console) !== 'undefined') {\n          console.warn(\n            `No such ellipsis-resize-detection strategy: '${this.resizeDetectionStrategy}'. Using 'element-resize-detector' instead`\n          );\n        }\n      // tslint:disable-next-line:no-switch-case-fall-through\n      case 'element-resize-detector':\n      case '':\n        this.addElementResizeListener();\n        break;\n    }\n  }\n\n  @HostListener('window:resize', ['$event']) onResize(event: Event) {\n    this.ngZone.run(() => {\n      if (this.applyOnWindowResize) {\n        this.applyEllipsis();\n      }\n    });\n  }\n\n  /**\n   * Set up an event listener to call applyEllipsis() whenever the element\n   * has been resized.\n   * @param scrollStrategy=true Use the default elementResizeDetector's - strategy - s. https://github.com/wnr/element-resize-detector\n   */\n  private addElementResizeListener(scrollStrategy = true) {\n    if (!EllipsisDirective.elementResizeDetector) {\n      const maker: any = elementResizeDetectorMaker;\n      EllipsisDirective.elementResizeDetector = maker({ strategy: scrollStrategy ? 'scroll' : 'object' });\n    }\n\n\n    let calledAsynchronously = false;\n    EllipsisDirective.elementResizeDetector.listenTo(this.elementRef.nativeElement, () => {\n      if (!calledAsynchronously) {\n        // elementResizeDetector fires the event directly after re-attaching the listener\n        // -> discard that first event:\n        return;\n      }\n      this.applyEllipsis();\n    });\n    calledAsynchronously = true;\n  }\n\n  /**\n   * Stop listening for any resize event.\n   */\n  private removeResizeListener() {\n    if (this.resizeDetectionStrategy !== 'window') {\n      if (EllipsisDirective.elementResizeDetector && this.elem) {\n        EllipsisDirective.elementResizeDetector.removeAllListeners(this.elem);\n      }\n    } else {\n      this.applyOnWindowResize = false;\n    }\n  }\n\n  /**\n   * Get the original text's truncated version. If the text really needed to\n   * be truncated, this.ellipsisCharacters will be appended.\n   * @param max the maximum length the text may have\n   * @return string       the truncated string\n   */\n  private getTruncatedText(max: number): string {\n    if (!this.originalText || this.originalText.length <= max) {\n      return this.originalText;\n    }\n\n    const truncatedText = this.originalText.substr(0, max);\n    if (this.ellipsisWordBoundaries === '[]' || this.originalText.charAt(max).match(this.ellipsisWordBoundaries)) {\n      return truncatedText + this.ellipsisCharacters;\n    }\n\n    let i = max - 1;\n    while (i > 0 && !truncatedText.charAt(i).match(this.ellipsisWordBoundaries)) {\n      i--;\n    }\n    return truncatedText.substr(0, i) + this.ellipsisCharacters;\n  }\n\n  /**\n   * Set the truncated text to be displayed in the inner div\n   * @param max the maximum length the text may have\n   * @param addMoreListener=false listen for click on the ellipsisCharacters if the text has been truncated\n   */\n  private truncateText(max: number, addMoreListener = false) {\n    const text = this.getTruncatedText(max);\n    this.renderer.setProperty(this.innerElem, 'innerHTML', text);\n\n    if (!addMoreListener) {\n      return;\n    }\n\n    // Remove any existing more click listener:\n    if (this.destroyMoreClickListener) {\n      this.destroyMoreClickListener();\n    }\n\n    // If the text has been truncated, add a more click listener:\n    if (text !== this.originalText) {\n      this.destroyMoreClickListener = this.renderer.listen(this.innerElem, 'click', (e: any) => {\n        if (!e.target || e.target.className !== 'ngx-ellipsis-more') {\n          return;\n        }\n        e.preventDefault();\n        this.moreClickEmitter.emit(e);\n      });\n    }\n  }\n\n  /**\n   * Display ellipsis in the inner div if the text would exceed the boundaries\n   */\n  private applyEllipsis() {\n    // Remove the resize listener as changing the contained text would trigger events:\n    this.removeResizeListener();\n\n    // Find the best length by trial and error:\n    const maxLength = EllipsisDirective.numericBinarySearch(this.originalText.length, curLength => {\n      this.truncateText(curLength);\n      return !this.isOverflowing;\n    });\n\n    // Apply the best length:\n    this.truncateText(maxLength, (this.moreClickEmitter.observers.length > 0));\n\n    // Re-attach the resize listener:\n    this.addResizeListener();\n  }\n\n\n  /**\n   * Whether the text is exceeding the element's boundaries or not\n   */\n  private get isOverflowing(): boolean {\n    // Enforce hidden overflow (required to compare client width/height with scroll width/height)\n    const currentOverflow = this.elem.style.overflow;\n    if (!currentOverflow || currentOverflow === 'visible') {\n      this.elem.style.overflow = 'hidden';\n    }\n\n    const isOverflowing = this.elem.clientWidth < this.elem.scrollWidth - 1 || this.elem.clientHeight < this.elem.scrollHeight - 1;\n\n    // Reset overflow to the original configuration:\n    this.elem.style.overflow = currentOverflow;\n\n    return isOverflowing;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { EllipsisDirective } from './directives/ellipsis.directive';\n\n@NgModule({\n  imports: [\n  ],\n  declarations: [EllipsisDirective],\n  exports: [EllipsisDirective]\n})\nexport class EllipsisModule { }\n"]}